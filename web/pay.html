<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thanh To√°n - 4MenShop</title>
    <link rel="stylesheet" href="css/pay.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-container">
        <div class="breadcrumb">
          <span><i class="fas fa-home"></i> Trang ch·ªß</span>
          <span class="separator">></span>
          <span>Thanh to√°n</span>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
      <div class="product-section">
        <!-- Product Images -->
        <div class="product-images">
          <div class="main-image">
            <img id="product-image" src="" alt="S·∫£n ph·∫©m" />
            <div class="image-zoom-indicator">
              <i class="fas fa-search-plus"></i>
            </div>
          </div>
          <div class="thumbnail-images" id="thumbnail-container">
            <!-- Thumbnails will be populated by JavaScript -->
          </div>
        </div>

        <!-- Product Information -->
        <div class="product-info">
          <div class="product-header">
            <h1 class="product-title" id="product-title"></h1>
            <div class="product-rating">
              <div class="stars">
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
              </div>
              <span class="rating-text">(5.0) | 127 ƒë√°nh gi√°</span>
            </div>
            <div class="product-code">
              <span>M√£ s·∫£n ph·∫©m: <strong id="product-code">SP001</strong></span>
            </div>
          </div>

          <div class="price-section">
            <div class="current-price" id="product-price"></div>
            <div class="original-price" id="original-price" style="display: none;"></div>
            <div class="discount-badge" id="discount-badge" style="display: none;">
              <span>-15%</span>
            </div>
          </div>

          <div class="product-options">
            <!-- Color Selection -->
            <div class="option-group">
              <label class="option-label">M√†u s·∫Øc:</label>
              <div class="color-options" id="color-options">
                <!-- Color options will be populated by JavaScript -->
              </div>
            </div>

            <!-- Size Selection -->
            <div class="option-group" id="size-section" style="display: none">
              <label class="option-label" for="size">K√≠ch th∆∞·ªõc:</label>
              <div class="size-options">
                <select id="size" class="size-select">
                  <option value="">Ch·ªçn k√≠ch th∆∞·ªõc</option>
                </select>
              </div>
              <div class="size-guide">
                <a href="#" class="size-guide-link">
                  <i class="fas fa-ruler"></i> H∆∞·ªõng d·∫´n ch·ªçn size
                </a>
              </div>
            </div>

            <!-- Quantity Selection -->
            <div class="option-group">
              <label class="option-label" for="quantity">S·ªë l∆∞·ª£ng:</label>
              <div class="quantity-controls">
                <button type="button" class="qty-btn" id="decrease-qty">-</button>
                <input type="number" id="quantity" value="1" min="1" max="99" readonly />
                <button type="button" class="qty-btn" id="increase-qty">+</button>
              </div>
              <div class="stock-info">
                <i class="fas fa-check-circle"></i>
                <span>C√≤n h√†ng (50+ s·∫£n ph·∫©m)</span>
              </div>
            </div>
          </div>

          <!-- Total Price -->
          <div class="total-section">
            <div class="total-price" id="total"></div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button class="btn btn-primary order-button" onclick="placeOrder()">
              <i class="fas fa-shopping-cart"></i>
              Th√™m v√†o gi·ªè h√†ng
            </button>
            <button class="btn btn-secondary buy-now-button" onclick="buyNow()">
              <i class="fas fa-bolt"></i>
              Mua ngay
            </button>
            <button class="btn btn-outline cancel-button" onclick="history.back()">
              <i class="fas fa-arrow-left"></i>
              Quay l·∫°i
            </button>
          </div>

          <!-- Additional Info -->
          <div class="product-benefits">
            <div class="benefit-item">
              <i class="fas fa-truck"></i>
              <span>Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn cho ƒë∆°n h√†ng t·ª´ 500.000ƒë</span>
            </div>
            <div class="benefit-item">
              <i class="fas fa-undo"></i>
              <span>ƒê·ªïi tr·∫£ mi·ªÖn ph√≠ trong 30 ng√†y</span>
            </div>
            <div class="benefit-item">
              <i class="fas fa-shield-alt"></i>
              <span>B·∫£o h√†nh ch√≠nh h√£ng</span>
            </div>
            <div class="benefit-item">
              <i class="fas fa-headset"></i>
              <span>H·ªó tr·ª£ 24/7</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const product = JSON.parse(localStorage.getItem("selectedProduct"));
      const defaultImage = product?.image;
      let currentPrice = parseInt(product.price);

      function updateTotal() {
        const quantity = parseInt(document.getElementById("quantity").value);
        const total = currentPrice * quantity;
        document.getElementById("total").innerHTML = 
          `<span class="total-label">T·ªïng c·ªông:</span><span class="total-amount">${total.toLocaleString()} ‚Ç´</span>`;
      }

      function updateQuantity(change) {
        const quantityInput = document.getElementById("quantity");
        let currentQty = parseInt(quantityInput.value);
        let newQty = currentQty + change;
        
        if (newQty >= 1 && newQty <= 99) {
          quantityInput.value = newQty;
          updateTotal();
        }
      }

      function placeOrder() {
        const sizeSelect = document.getElementById("size");
        const size = sizeSelect && sizeSelect.value ? sizeSelect.value : "Kh√¥ng ch·ªçn";
        const quantity = parseInt(document.getElementById("quantity").value);
        const name = document.getElementById("product-title").innerText.trim();
        const price = currentPrice;
        const image = document.getElementById("product-image").src;

        const productToSave = {
          name: name,
          price: price,
          quantity: quantity,
          size: size,
          image: image,
        };

        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        const existingIndex = cart.findIndex(
          (item) => item.name === productToSave.name && item.size === productToSave.size
        );

        if (existingIndex !== -1) {
          cart[existingIndex].quantity += quantity;
        } else {
          cart.push(productToSave);
        }

        localStorage.setItem("cart", JSON.stringify(cart));

        const formattedPrice = (price * quantity).toLocaleString("vi-VN") + " ‚Ç´";

        alert(
          `üõí ƒê√£ th√™m v√†o gi·ªè h√†ng!\n\n` +
          `üßæ S·∫£n ph·∫©m: ${name}\n` +
          `üì¶ S·ªë l∆∞·ª£ng: ${quantity}\n` +
          `üìê Size: ${size}\n` +
          `üí∞ T·ªïng ti·ªÅn: ${formattedPrice}`
        );
      }

      function buyNow() {
        placeOrder();
        window.location.href = "checkout.html";
      }

      if (product) {
        document.getElementById("product-title").innerText = product.title;
        document.getElementById("product-image").src = product.image;
        document.getElementById("product-price").innerText = parseInt(product.price).toLocaleString() + " ‚Ç´";
        updateTotal();
        showSizeOptions(product.type);
      }

      // Event listeners
      document.getElementById("increase-qty").addEventListener("click", () => updateQuantity(1));
      document.getElementById("decrease-qty").addEventListener("click", () => updateQuantity(-1));
      document.getElementById("quantity").addEventListener("input", updateTotal);

      // Color options
      const colorContainer = document.getElementById("color-options");
      if (product.colors && Array.isArray(product.colors)) {
        product.colors.forEach((color, index) => {
          const colorOption = document.createElement("div");
          colorOption.className = "color-option";
          if (index === 0) colorOption.classList.add("selected");
          
          const img = document.createElement("img");
          img.src = color.image;
          img.alt = color.name;
          img.title = color.name;
          
          const colorName = document.createElement("span");
          colorName.className = "color-name";
          colorName.textContent = color.name;
          
          colorOption.appendChild(img);
          colorOption.appendChild(colorName);

          colorOption.onclick = () => {
            document.getElementById("product-image").src = color.image;
            document.getElementById("product-title").innerText = color.title;
            document.getElementById("product-price").innerText = parseInt(color.price).toLocaleString() + " ‚Ç´";

            currentPrice = parseInt(color.price);
            updateTotal();

            document.querySelectorAll(".color-option").forEach((el) => el.classList.remove("selected"));
            colorOption.classList.add("selected");
          };

          colorContainer.appendChild(colorOption);
        });
      }

      function showSizeOptions(type) {
        const sizeSection = document.getElementById("size-section");
        const sizeSelect = document.getElementById("size");

        if (!type) {
          sizeSection.style.display = "none";
          return;
        }

        sizeSelect.innerHTML = '<option value="">Ch·ªçn k√≠ch th∆∞·ªõc</option>';

        if (type === "ao") {
          ["S", "M", "L", "XL"].forEach((size) => {
            const option = document.createElement("option");
            option.value = size;
            option.innerText = size;
            sizeSelect.appendChild(option);
          });
          sizeSection.style.display = "block";
        } else if (type === "quan") {
          ["29", "30", "31", "32", "34"].forEach((size) => {
            const option = document.createElement("option");
            option.value = size;
            option.innerText = size;
            sizeSelect.appendChild(option);
          });
          sizeSection.style.display = "block";
        } else {
          sizeSection.style.display = "none";
        }
      }
    </script>
  </body>
</html>
